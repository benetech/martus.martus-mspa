Installing and Testing the MSPA Client and Server
2007-11-05 kbs

There are three components. Two on the server, and one on the client.

=============================================================================
SERVER SIDE
-----------
There are two server components: The main MSPA Server, and the RootHelper.
If RootHelper is not running, the commands to start, stop, restart, and query 
the status of the service are not available. Everything else will work fine 
without the RootHelper.


ROOT HELPER
-----------
The root helper would normally be run first, by root. However, it doesn't really 
matter, as long as it is running by the time the MSPA client attempts to start, 
stop, restart, or query the status of the MartusServer service. It is assumed to 
be running on the same computer as the main MSPAServer.

The root helper does not require any data directories.

To run RootHelper, the class to execute is: org.martus.mspa.roothelper.RootHelper

Normally it listens on port 983. Since the whole point is to run as root, that 
shouldn't be a problem even on Linux boxes. However, it does support a command 
line option to choose a different port (--port=1234).

In order to have any effect, the RootHelper must be able to execute the following 
commands:
  /etc/init.d/martus state
  /etc/init.d/martus start
  /etc/init.d/martus stop
  /etc/init.d/martus restart


MSPASERVER
----------

The main MSPA server class to run is: org.martus.mspa.server.MSPAServer

MSPAServer has data directory requirements:

/var/MSPAServer
/var/MSPAServer/MartusServerData/
	(Symlink to the main MartusServer data dir, typically /var/MartusServer/)
/var/MSPAServer/adminTriggers/
	(Can be empty)
/var/MSPAServer/deleteOnStartup/
	keypair.dat
	clientsWhoCallUs/
		(Contains <publiccode>.mpi files for each authorized MSPA client)
		(NOTE: .mpi must be in server format, not client format)

When run, it will request a password, which will be used to create the SSL cert, and 
will be forwarded to the RootHelper each time a start, or restart is requested. 

When run as non-root on Linux systems, you must use the --port= command line 
option to avoid using the default port of 984 to listen to MSPA clients. Also, 
if you specified a RootHelper port, you must match it with a --roothelper-port= 
command line setting.


=============================================================================
CLIENT SIDE
-----------
The MSPA client requires the following data to exist on the client computer:

~/MSPAClient/
	keypair.dat
		(In server format, not compatible with Martus client. See below.)
	knownServers/
		(Contain a list of server public key files, each with a filename 
		 that includes the IP address, such as "ip=1.2.3.4")
		 
NOTE: On Windows, replace ~ with C:\

You will need to create a keypair as c:/MSPAClient/keypair.dat
The easiest way to do this is by running org.martus.server.tools.CreateKeyPair
NOTE: You must include both a password and a username in the password,
in the form:   password:username

You will need to export your public key, and install it in the MSPAServer's 
deleteOnStartup/clientsWhoCallUs directory. To create the public key file, run
org.martus.server.tools.ExportPublicKey
Remember to enter password:username   when prompted for the password.

Note that the public key MUST be in the "server" public key format, and 
not in the format generated by the Martus Client "Export my public key" 
command.

You will need the public key file for the MSPA Listener. It must be 
named with the correct IP address and public code. This file must be placed 
in the MSPAClient/knownServers/ directory.

The class to run for the client is: org.martus.mspa.main.MSPAMain

